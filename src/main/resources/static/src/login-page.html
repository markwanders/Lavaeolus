<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-a11y-keys/iron-a11y-keys.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/neon-animation/neon-animatable-behavior.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="shared-styles.html">

<dom-module id="login-page">
    <template>
        <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
      .wrapper-btns {
        margin-top: 15px;
      }
    </style>

        <div class="card">
            <h1>Log in</h1>
            <iron-a11y-keys keys="enter" on-keys-pressed="_logIn"></iron-a11y-keys>
            <iron-form id="form">
                <form method="post" action="/login">
                    <paper-input value={{username}} label="Username" name="username" required
                                 autofocus></paper-input>
                    <paper-input value="{{password}}" label="Password" name="password"
                                 type="password" required></paper-input>
                    <span class="error-message" hidden="[[!errorMessage]]">[[errorMessage]]</span>
                    <div class="wrapper-btns">
                        <paper-button id="login-button" class="primary" on-tap="_logIn" raised>Login</paper-button>
                        <paper-button on-tap="_register">Sign Up</paper-button>
                    </div>
                </form>
            </iron-form>
        </div>
    </template>
    <script>
    Polymer({
      is: 'login-page',

      behaviors: [Polymer.NeonAnimatableBehavior],

      properties: {
        username: String,
        password: String,
        errorMessage: String,
        token: {
          type: String,
          notify: true
        }
      },

      listeners: {
        'iron-form-response': '_handleLoginSuccess',
        'iron-form-error': '_handleLoginError'
      },

      observers: ['_errorClearer(username, password)'],

      _errorClearer: function() {
        this.errorMessage = '';
      },

      _logIn: function() {
        this.$.form.submit();
      },

      _handleLoginSuccess: function(evt) {
        this.token = evt.detail.xhr.getResponseHeader('x-auth-token');
      },

      _handleLoginError: function() {
        this.errorMessage = 'You are doing it wrong.'
      }
    });
  </script>
</dom-module>