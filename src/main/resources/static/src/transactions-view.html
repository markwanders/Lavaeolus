<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="shared-styles.html">

<dom-module id="transactions-view">
    <template>
        <style include="shared-styles">
            :host {
                display: block;

                padding: 10px;
            }
        </style>

        <app-location
                route="{{route}}"
                url-space-regex="^[[rootPath]]">
        </app-location>

        <app-route
                route="{{route}}"
                pattern="[[rootPath]]:page/:accountType"
                data="{{routeData}}"
                tail="{{subroute}}">
        </app-route>

        <template is="dom-repeat" items="{{transactions}}" as="transaction">
            <div class="card">
                <h1>{{getFormattedTimestamp(transaction.dateTime)}}</h1>
                <dl>
                    <dt>To/from:</dt>
                    <dd>{{transaction.counterParty}}</dd>
                    <dt>Amount:</dt>
                    <dd>{{transaction.amount}} {{transaction.currency}}</dd>
                    <dt>Description:</dt>
                    <dd>{{transaction.description}}</dd>
                </dl>
            </div>
        </template>

        <iron-ajax
                id="transactions"
                headers={{headers}}
                method="GET"
                content-type="application/json"
                handle-as="json"
                loading="{{loading}}"
                last-response="{{transactions}}">
        </iron-ajax>
    </template>

    <script>
    class TransactionsView extends Polymer.Element {
        static get is() { return 'transactions-view'; }

        static get properties() {
            return {
                transactions: Object,
                token: {
                    type: String,
                    notify: true,
                    observer: '_tokenUpdated'
                },
                loading: {
                      type: Boolean,
                      notify: true
                },
                headers: {
                    type: Object,
                    computed: '_getHeader(token)'
                }
            }
        }

         go() {
            this.$.transactions.url = "/api/accounts/bunq/1881/transactions";
            this.$.transactions.generateRequest();
         }

        getFormattedTimestamp(timestamp) {
            var date = new Date(timestamp * 1000);
            return date.toLocaleDateString("en-US");
        }

         _tokenUpdated(){
            if(this.token){
                this.go();
            }
        }

        _getHeader(token) {
            return {'x-auth-token': token};
        }

    }

    window.customElements.define(TransactionsView.is, TransactionsView);
  </script>
</dom-module>
